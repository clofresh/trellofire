var _action_parser=function(){function e(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}function t(e,t,r,n,a,s){this.message=e,this.expected=t,this.found=r,this.offset=n,this.line=a,this.column=s,this.name="SyntaxError"}function r(e){function r(t){function r(t,r,n){var a,s;for(a=r;n>a;a++)s=e.charAt(a),"\n"===s?(t.seenCR||t.line++,t.column=1,t.seenCR=!1):"\r"===s||"\u2028"===s||"\u2029"===s?(t.line++,t.column=1,t.seenCR=!0):(t.column++,t.seenCR=!1)}return T!==t&&(T>t&&(T=0,B={line:1,column:1,seenCR:!1}),r(B,T,t),T=t),B}function n(e){Q>L||(L>Q&&(Q=L,J=[]),J.push(e))}function a(n,a,s){function i(e){var t=1;for(e.sort(function(e,t){return e.description<t.description?-1:e.description>t.description?1:0});t<e.length;)e[t-1]===e[t]?e.splice(t,1):t++}function o(e,t){function r(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+t(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+t(e)}).replace(/[\u0180-\u0FFF]/g,function(e){return"\\u0"+t(e)}).replace(/[\u1080-\uFFFF]/g,function(e){return"\\u"+t(e)})}var n,a,s,i=new Array(e.length);for(s=0;s<e.length;s++)i[s]=e[s].description;return n=e.length>1?i.slice(0,-1).join(", ")+" or "+i[e.length-1]:i[0],a=t?'"'+r(t)+'"':"end of input","Expected "+n+" but "+a+" found."}var l=r(s),c=s<e.length?e.charAt(s):null;return null!==a&&i(a),new t(null!==n?n:o(a,c),a,c,s,l.line,l.column)}function s(){var e;return e=i()}function i(){var t,r,a,s;if(t=L,r=o(),r!==f){for(a=[],v.test(e.charAt(L))?(s=e.charAt(L),L++):(s=f,0===M&&n(y));s!==f;)a.push(s),v.test(e.charAt(L))?(s=e.charAt(L),L++):(s=f,0===M&&n(y));a!==f?(s=i(),s===f&&(s=b),s!==f?(I=t,r=x(r,s),t=r):(L=t,t=g)):(L=t,t=g)}else L=t,t=g;return t}function o(){var t,r,a,s;return t=L,r=l(),r!==f?(58===e.charCodeAt(L)?(a=C,L++):(a=f,0===M&&n(E)),a!==f?(s=c(),s!==f?(I=t,r=A(r,s),t=r):(L=t,t=g)):(L=t,t=g)):(L=t,t=g),t}function l(){var t;return e.substr(L,5)===w?(t=w,L+=5):(t=f,0===M&&n(S)),t}function c(){var t,r,a,s;if(t=L,34===e.charCodeAt(L)?(r=q,L++):(r=f,0===M&&n(j)),r!==f){if(a=[],N.test(e.charAt(L))?(s=e.charAt(L),L++):(s=f,0===M&&n(k)),s!==f)for(;s!==f;)a.push(s),N.test(e.charAt(L))?(s=e.charAt(L),L++):(s=f,0===M&&n(k));else a=g;a!==f?(34===e.charCodeAt(L)?(s=q,L++):(s=f,0===M&&n(j)),s!==f?(I=t,r=R(a),t=r):(L=t,t=g)):(L=t,t=g)}else L=t,t=g;if(t===f){if(t=L,r=[],F.test(e.charAt(L))?(a=e.charAt(L),L++):(a=f,0===M&&n(_)),a!==f)for(;a!==f;)r.push(a),F.test(e.charAt(L))?(a=e.charAt(L),L++):(a=f,0===M&&n(_));else r=g;r!==f&&(I=t,r=R(r)),t=r}return t}function u(e){return e.join("")}var p,d=arguments.length>1?arguments[1]:{},f={},h={start:s},m=s,g=f,v=/^[ ]/,y={type:"class",value:"[ ]",description:"[ ]"},b=null,x=function(e,t){var r=[e];return null===t?r:r.concat(t)},C=":",E={type:"literal",value:":",description:'":"'},A=function(e,t){return{field:e,value:t}},w="title",S={type:"literal",value:"title",description:'"title"'},q='"',j={type:"literal",value:'"',description:'"\\""'},N=/^[^"]/,k={type:"class",value:'[^"]',description:'[^"]'},R=function(e){return u(e)},F=/^[^ ]/,_={type:"class",value:"[^ ]",description:"[^ ]"},L=0,I=0,T=0,B={line:1,column:1,seenCR:!1},Q=0,J=[],M=0;if("startRule"in d){if(!(d.startRule in h))throw new Error("Can't start parsing from rule \""+d.startRule+'".');m=h[d.startRule]}if(p=m(),p!==f&&L===e.length)return p;throw p!==f&&L<e.length&&n({type:"end",description:"end of input"}),a(null,J,Q)}return e(t,Error),{SyntaxError:t,parse:r}}();define("peg/action",[],function(){return _action_parser}),define("action",["./peg/action"],function(e){return{parse:function(t){for(var r={fields:{}},n=e.parse(t),a=0;a<n.length;++a){var s=n[a],i=s.field,o=s.value;switch(i){case"title":r.fields[i]=o}}return r.terms=n,r.str=t,r}}});var _query_parser=function(){function e(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}function t(e,t,r,n,a,s){this.message=e,this.expected=t,this.found=r,this.offset=n,this.line=a,this.column=s,this.name="SyntaxError"}function r(e){function r(t){function r(t,r,n){var a,s;for(a=r;n>a;a++)s=e.charAt(a),"\n"===s?(t.seenCR||t.line++,t.column=1,t.seenCR=!1):"\r"===s||"\u2028"===s||"\u2029"===s?(t.line++,t.column=1,t.seenCR=!0):(t.column++,t.seenCR=!1)}return K!==t&&(K>t&&(K=0,W={line:1,column:1,seenCR:!1}),r(W,K,t),K=t),W}function n(e){$>Z||(Z>$&&($=Z,et=[]),et.push(e))}function a(n,a,s){function i(e){var t=1;for(e.sort(function(e,t){return e.description<t.description?-1:e.description>t.description?1:0});t<e.length;)e[t-1]===e[t]?e.splice(t,1):t++}function o(e,t){function r(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+t(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+t(e)}).replace(/[\u0180-\u0FFF]/g,function(e){return"\\u0"+t(e)}).replace(/[\u1080-\uFFFF]/g,function(e){return"\\u"+t(e)})}var n,a,s,i=new Array(e.length);for(s=0;s<e.length;s++)i[s]=e[s].description;return n=e.length>1?i.slice(0,-1).join(", ")+" or "+i[e.length-1]:i[0],a=t?'"'+r(t)+'"':"end of input","Expected "+n+" but "+a+" found."}var l=r(s),c=s<e.length?e.charAt(s):null;return null!==a&&i(a),new t(null!==n?n:o(a,c),a,c,s,l.line,l.column)}function s(){var e;return e=i()}function i(){var t,r,a,s;if(t=Z,r=o(),r!==m){for(a=[],b.test(e.charAt(Z))?(s=e.charAt(Z),Z++):(s=m,0===tt&&n(x));s!==m;)a.push(s),b.test(e.charAt(Z))?(s=e.charAt(Z),Z++):(s=m,0===tt&&n(x));a!==m?(s=i(),s===m&&(s=C),s!==m?(H=t,r=E(r,s),t=r):(Z=t,t=y)):(Z=t,t=y)}else Z=t,t=y;return t}function o(){var t,r,a,s,i;return t=Z,r=p(),r===m&&(r=C),r!==m?(a=c(),a!==m?(58===e.charCodeAt(Z)?(s=A,Z++):(s=m,0===tt&&n(w)),s!==m?(i=u(),i!==m?(H=t,r=S(r,a,i),t=r):(Z=t,t=y)):(Z=t,t=y)):(Z=t,t=y)):(Z=t,t=y),t===m&&(t=Z,r=l(),r!==m?(58===e.charCodeAt(Z)?(a=A,Z++):(a=m,0===tt&&n(w)),a!==m?(s=u(),s!==m?(H=t,r=q(r,s),t=r):(Z=t,t=y)):(Z=t,t=y)):(Z=t,t=y)),t}function l(){var t;return e.substr(Z,5)===j?(t=j,Z+=5):(t=m,0===tt&&n(N)),t===m&&(e.substr(Z,7)===k?(t=k,Z+=7):(t=m,0===tt&&n(R)),t===m&&(e.substr(Z,7)===F?(t=F,Z+=7):(t=m,0===tt&&n(_)),t===m&&(e.substr(Z,4)===L?(t=L,Z+=4):(t=m,0===tt&&n(I)),t===m&&(t=c())))),t}function c(){var t;return e.substr(Z,5)===T?(t=T,Z+=5):(t=m,0===tt&&n(B)),t===m&&(e.substr(Z,5)===Q?(t=Q,Z+=5):(t=m,0===tt&&n(J))),t}function u(){var t,r,a,s;if(t=Z,34===e.charCodeAt(Z)?(r=M,Z++):(r=m,0===tt&&n(U)),r!==m){if(a=[],D.test(e.charAt(Z))?(s=e.charAt(Z),Z++):(s=m,0===tt&&n(X)),s!==m)for(;s!==m;)a.push(s),D.test(e.charAt(Z))?(s=e.charAt(Z),Z++):(s=m,0===tt&&n(X));else a=y;a!==m?(34===e.charCodeAt(Z)?(s=M,Z++):(s=m,0===tt&&n(U)),s!==m?(H=t,r=O(a),t=r):(Z=t,t=y)):(Z=t,t=y)}else Z=t,t=y;if(t===m){if(t=Z,r=[],V.test(e.charAt(Z))?(a=e.charAt(Z),Z++):(a=m,0===tt&&n(P)),a!==m)for(;a!==m;)r.push(a),V.test(e.charAt(Z))?(a=e.charAt(Z),Z++):(a=m,0===tt&&n(P));else r=y;r!==m&&(H=t,r=O(r)),t=r}return t}function p(){var t,r,a,s;if(t=Z,33===e.charCodeAt(Z)?(r=z,Z++):(r=m,0===tt&&n(G)),r!==m){for(a=[],b.test(e.charAt(Z))?(s=e.charAt(Z),Z++):(s=m,0===tt&&n(x));s!==m;)a.push(s),b.test(e.charAt(Z))?(s=e.charAt(Z),Z++):(s=m,0===tt&&n(x));a!==m?(H=t,r=Y(),t=r):(Z=t,t=y)}else Z=t,t=y;return t}function d(e){return e.join("")}var f,h=arguments.length>1?arguments[1]:{},m={},g={start:s},v=s,y=m,b=/^[ ]/,x={type:"class",value:"[ ]",description:"[ ]"},C=null,E=function(e,t){var r=[e];return null===t?r:r.concat(t)},A=":",w={type:"literal",value:":",description:'":"'},S=function(e,t,r){return{field:t,value:r,op:e}},q=function(e,t){return{field:e,value:t}},j="board",N={type:"literal",value:"board",description:'"board"'},k="groupby",R={type:"literal",value:"groupby",description:'"groupby"'},F="sortdir",_={type:"literal",value:"sortdir",description:'"sortdir"'},L="sort",I={type:"literal",value:"sort",description:'"sort"'},T="title",B={type:"literal",value:"title",description:'"title"'},Q="state",J={type:"literal",value:"state",description:'"state"'},M='"',U={type:"literal",value:'"',description:'"\\""'},D=/^[^"]/,X={type:"class",value:'[^"]',description:'[^"]'},O=function(e){return d(e)},V=/^[^ ]/,P={type:"class",value:"[^ ]",description:"[^ ]"},z="!",G={type:"literal",value:"!",description:'"!"'},Y=function(){return{type:"unary",name:"not"}},Z=0,H=0,K=0,W={line:1,column:1,seenCR:!1},$=0,et=[],tt=0;if("startRule"in h){if(!(h.startRule in g))throw new Error("Can't start parsing from rule \""+h.startRule+'".');v=g[h.startRule]}if(f=v(),f!==m&&Z===e.length)return f;throw f!==m&&Z<e.length&&n({type:"end",description:"end of input"}),a(null,et,$)}return e(t,Error),{SyntaxError:t,parse:r}}();define("peg/query",[],function(){return _query_parser}),define("stores/lists",[],function(){var e={};return e.lists={},e.set=function(t,r){e.lists[t]=r},e.get=function(t){return e.lists[t]},e}),define("query",["./peg/query","stores/lists"],function(e,t){var r={list:"idList",state:"closed"},n={asc:function(e,t){return e.localeCompare(t)},desc:function(e,t){return t.localeCompare(e)}};return{parse:function(a){for(var s={filters:[]},i=e.parse(a),o=0;o<i.length;++o){var l=i[o],c=l.field,u=l.value;switch(c){case"board":s[c]=u;break;case"sortdir":s.compare=n[u];break;case"sort":var p;switch(u){case"list":p=function(e,r){return this.compare(t.get(e.idList).name,t.get(r.idList).name)}.bind(s);break;case"state":p=function(e,t){return this.compare(e.closed?"c":"o",t.closed?"c":"o")}.bind(s);break;case"mod":p=function(e,t){return this.compare(e.dateLastActivity,t.dateLastActivity)}.bind(s);break;case"due":p=function(e,t){return this.compare(e.due,t.due)}.bind(s)}s.sorter=p;break;case"groupby":s[c]=r[u]||u;break;case"title":l.field="name",s.filters.push(l);break;case"state":l.field="closed","closed"===l.value?(l.value=!0,s.filters.push(l)):"open"===l.value?(l.value=!1,s.filters.push(l)):console.log("Ignoring state filter: "+l.value)}}return void 0!==s.sorter&&void 0==s.compare&&(s.compare=n.asc),s.terms=i,s.str=a,s}}}),define("stores/selected",[],function(){var e={};return e.selected={},e.set=function(t,r){e.selected[t]=r},e.any=function(){for(var t in e.selected)if(e.selected[t])return!0;return!1},e.getSelected=function(){var t=[];return Object.keys(e.selected).forEach(function(r){e.selected[r]&&t.push(r)}),t},e}),define("views/trello_item",["react","stores/lists","stores/selected"],function(e,t,r){return e.createClass({getInitialState:function(){return{checked:!1}},handleClick:function(e){if("A"!==e.target.tagName){var t=!this.state.checked;this.setState({checked:t}),r.set(this.props.data.id,t)}},render:function(){return e.createElement("tr",{className:"trelloItem",onClick:this.handleClick},e.createElement("td",{className:"checkCol"},e.createElement("input",{type:"checkbox",checked:this.state.checked,onChange:this.handleClick})),e.createElement("td",{className:"titleCol"},e.createElement("a",{href:this.props.data.url},this.props.data.name)),e.createElement("td",{className:"listCol"},t.get(this.props.data.idList).name),e.createElement("td",{className:"stateCol"},this.props.data.closed?"closed":"open"),e.createElement("td",{className:"modCol"},this.props.data.dateLastActivity),e.createElement("td",{className:"dueCol"},this.props.data.due))}})}),define("views/trello_group",["react","./trello_item"],function(e,t){return e.createClass({render:function(){var r,n=this.props.cards.map(function(r){return e.createElement(t,{key:r.id,data:r})});return null!==this.props.group&&(r=e.createElement("div",{className:"panel-heading"},e.createElement("h1",{className:"panel-title"},this.props.group))),e.createElement("div",{className:"trelloGroup panel panel-info"},r,e.createElement("table",{className:"trello table table-striped"},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",{className:"checkCol"},"Â "),e.createElement("th",{className:"titleCol"},"Title"),e.createElement("th",{className:"listCol"},"List"),e.createElement("th",{className:"stateCol"},"State"),e.createElement("th",{className:"modCol"},"Last modified"),e.createElement("th",{className:"dueCol"},"Due"))),e.createElement("tbody",null,n)))}})}),define("views/query_bar",["react","query"],function(e,t){return e.createClass({getDefaultProps:function(){return{queue:[]}},getInitialState:function(){return t.parse(this.props.defaultQuery)},handleSubmit:function(e){e.preventDefault(),this.updateVal(e.target.getElementsByTagName("input")[0].value)},handleChange:function(e){this.state.timer&&clearTimeout(this.state.timer);var t=e.target;this.state.timer=setTimeout(function(){this.updateVal(t.value)}.bind(this),500)},updateVal:function(e){var r;if(""===e)r={str:""};else try{r=t.parse(e);var n=window.location.origin+window.location.pathname+"?q="+encodeURIComponent(e);history.replaceState(null,null,n),localStorage.query=e}catch(a){a.message?(console.log(a),alert(a.message)):console.log(a)}void 0!==r&&(this.setState(r),this.props.onUpdate(r))},render:function(){return e.createElement("h3",{className:"page-header"},e.createElement("form",{onSubmit:this.handleSubmit},e.createElement("input",{id:"queryInput",type:"text",className:"form-control",defaultValue:this.state.str,onChange:this.handleChange})))}})}),define("views/trello_board",["react","trello","action","query","stores/lists","stores/selected","./trello_group","./query_bar"],function(e,t,r,n,a,s,i,o){return e.createClass({getInitialState:function(){return{response:{cards:[]},filtered:[],query:n.parse(this.props.defaultQuery)}},updateBoard:function(e){console.log("Updating board with query",e),t.boards.get(e.board,{cards:"all",lists:"all"},function(t){for(var r=0;r<t.lists.length;r++){var n=t.lists[r];a.set(n.id,n)}this.setState({response:t,filtered:[],query:e})}.bind(this))},componentDidMount:function(){this.updateBoard(this.state.query)},updateQuery:function(e){this.state.query.board!==e.board?this.updateBoard(e):(this.state.query=e,this.setState(this.state))},handleActionMenu:function(e){if(s.any()){e.preventDefault();var t=document.getElementById("context-menu");t.style.left=JSON.stringify(e.pageX-100)+"px",t.style.top=JSON.stringify(e.pageY-80)+"px",t.classList.contains("open")||t.classList.add("open");var r=document.getElementById("context-menu-input");r.value="",r.focus(),document.onkeydown=function(e){27===e.keyCode&&(this.closeMenu(),e.preventDefault())}.bind(this)}},closeMenu:function(){var e=document.getElementById("context-menu");e.classList.remove("open"),document.onkeydown=null},handleActionSubmit:function(e){e.preventDefault();var n=r.parse(e.target.getElementsByTagName("input")[0].value),a=s.getSelected();for(var i in n.fields)switch(i){case"title":for(var o=n.fields[i],l=[],c=0;c<a.length;++c){var u=a[c];console.log(u,o),l.push(t.put("cards/"+u+"/name",{value:o}));for(var p=0;p<this.state.response.cards.length;++p){var d=this.state.response.cards[c];d.id===u&&(d.name=o)}}console.log(l)}this.setState(this.state),this.closeMenu()},render:function(){for(var t={},r=this.state.response.cards,n=this.state.query.filters,a=this.state.query.groupby,s=0;s<r.length;++s){for(var l=r[s],c=!0,u=0;u<n.length;++u){var p=n[u],d=l[p.field];switch(typeof d){case"boolean":c=p.op&&"not"==p.op.name?c&&d!==p.value:c&&d===p.value;break;case"string":c=p.op&&"not"==p.op.name?c&&!d.match(p.value):c&&d.match(p.value)}}if(c){var f=l[a]||"ungrouped";void 0===t[f]?t[f]=[l]:t[f].push(l)}}var h=this.state.query.sorter,m=[];for(var g in t){var r=t[g];null!==h&&r.sort(h);var v;v=void 0===a?null:this.groupName(g),m.push(e.createElement(i,{key:g,group:v,cards:r}))}return e.createElement("div",{className:"container",onContextMenu:this.handleActionMenu},e.createElement(o,{defaultQuery:this.props.defaultQuery,onUpdate:this.updateQuery})," ",m,e.createElement("div",{id:"context-menu",className:"dropdown"},e.createElement("ul",{className:"dropdown-menu"},e.createElement("li",null,e.createElement("form",{id:"action-form",onSubmit:this.handleActionSubmit},e.createElement("label",null,"Action: "),e.createElement("input",{id:"context-menu-input",text:"type"}))))))},groupName:function(e){switch(this.state.query.groupby){case"idList":var t=a.get(e);return void 0!==t?t.name:"N/A";case"closed":return"true"===e?"closed":"open";default:return e}}})}),define("app",["react","./views/trello_board"],function(e,t){var r={};return r.init=function(r,n){var n=n||document.body;e.render(e.createElement(t,{defaultQuery:r}),n)},r}),define("util",{setQueryString:function(e){var t=[];for(var r in e)t.push(r+"="+e[r]);window.location.search="?"+t.join("&")},getQueryString:function(){var e=window.location.search.substr(1).split("&");if(""==e)return{};for(var t={},r=0;r<e.length;++r){var n=e[r].split("=",2);t[n[0]]=1==n.length?"":decodeURIComponent(n[1].replace(/\+/g," "))}return t}}),require.config({baseUrl:"js",paths:{bootstrap:"//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/js/bootstrap.min",jquery:"//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min",jsx:"bower_components/requirejs-react-jsx/jsx",JSXTransformer:"//cdnjs.cloudflare.com/ajax/libs/react/0.13.3/JSXTransformer",react:"//cdnjs.cloudflare.com/ajax/libs/react/0.13.3/react",text:"bower_components/requirejs-text/text",trello:"//api.trello.com/1/client.js?key=cd8f1241e56eb1c3d1fc2eb3b1d0708f"},shim:{bootstrap:["jquery"],JSXTransformer:"JSXTransformer",react:{exports:"React"},trello:{deps:["jquery"],exports:"Trello"}},config:{jsx:{fileExtension:".jsx",transformOptions:{harmony:!0,stripTypes:!1,inlineSourceMap:!0},usePragma:!1}}}),require(["app","jquery","trello","bootstrap","util"],function(e,t,r,n,a){r.authorize({name:"Trellofire",scope:{read:!0,write:!0,account:!1},expiration:"never",success:function(){var t=a.getQueryString(),r=t.q||localStorage.query||"board:nC8QJJoZ groupby:list";e.init(r,document.getElementById("app"))},error:function(){alert("error")}})}),define("main",function(){});
//# sourceMappingURL=main.js.map