var _parser=function(){function e(e,t){function r(){this.constructor=e}r.prototype=t.prototype,e.prototype=new r}function t(e,t,r,n,a,s){this.message=e,this.expected=t,this.found=r,this.offset=n,this.line=a,this.column=s,this.name="SyntaxError"}function r(e){function r(t){function r(t,r,n){var a,s;for(a=r;n>a;a++)s=e.charAt(a),"\n"===s?(t.seenCR||t.line++,t.column=1,t.seenCR=!1):"\r"===s||"\u2028"===s||"\u2029"===s?(t.line++,t.column=1,t.seenCR=!0):(t.column++,t.seenCR=!1)}return H!==t&&(H>t&&(H=0,K={line:1,column:1,seenCR:!1}),r(K,H,t),H=t),K}function n(e){W>G||(G>W&&(W=G,Y=[]),Y.push(e))}function a(n,a,s){function i(e){var t=1;for(e.sort(function(e,t){return e.description<t.description?-1:e.description>t.description?1:0});t<e.length;)e[t-1]===e[t]?e.splice(t,1):t++}function o(e,t){function r(e){function t(e){return e.charCodeAt(0).toString(16).toUpperCase()}return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E\x0F]/g,function(e){return"\\x0"+t(e)}).replace(/[\x10-\x1F\x80-\xFF]/g,function(e){return"\\x"+t(e)}).replace(/[\u0180-\u0FFF]/g,function(e){return"\\u0"+t(e)}).replace(/[\u1080-\uFFFF]/g,function(e){return"\\u"+t(e)})}var n,a,s,i=new Array(e.length);for(s=0;s<e.length;s++)i[s]=e[s].description;return n=e.length>1?i.slice(0,-1).join(", ")+" or "+i[e.length-1]:i[0],a=t?'"'+r(t)+'"':"end of input","Expected "+n+" but "+a+" found."}var l=r(s),u=s<e.length?e.charAt(s):null;return null!==a&&i(a),new t(null!==n?n:o(a,u),a,u,s,l.line,l.column)}function s(){var e;return e=i()}function i(){var t,r,a,s;if(t=G,r=o(),r!==m){for(a=[],b.test(e.charAt(G))?(s=e.charAt(G),G++):(s=m,0===$&&n(C));s!==m;)a.push(s),b.test(e.charAt(G))?(s=e.charAt(G),G++):(s=m,0===$&&n(C));a!==m?(s=i(),s===m&&(s=E),s!==m?(O=t,r=x(r,s),t=r):(G=t,t=y)):(G=t,t=y)}else G=t,t=y;return t}function o(){var t,r,a,s,i;return t=G,r=p(),r===m&&(r=E),r!==m?(a=u(),a!==m?(58===e.charCodeAt(G)?(s=j,G++):(s=m,0===$&&n(q)),s!==m?(i=c(),i!==m?(O=t,r=A(r,a,i),t=r):(G=t,t=y)):(G=t,t=y)):(G=t,t=y)):(G=t,t=y),t===m&&(t=G,r=l(),r!==m?(58===e.charCodeAt(G)?(a=j,G++):(a=m,0===$&&n(q)),a!==m?(s=c(),s!==m?(O=t,r=N(r,s),t=r):(G=t,t=y)):(G=t,t=y)):(G=t,t=y)),t}function l(){var t;return e.substr(G,5)===S?(t=S,G+=5):(t=m,0===$&&n(w)),t===m&&(e.substr(G,7)===k?(t=k,G+=7):(t=m,0===$&&n(R)),t===m&&(e.substr(G,4)===_?(t=_,G+=4):(t=m,0===$&&n(F)),t===m&&(e.substr(G,7)===Q?(t=Q,G+=7):(t=m,0===$&&n(T)),t===m&&(t=u())))),t}function u(){var t;return e.substr(G,5)===J?(t=J,G+=5):(t=m,0===$&&n(I)),t}function c(){var t,r,a,s;if(t=G,34===e.charCodeAt(G)?(r=U,G++):(r=m,0===$&&n(B)),r!==m){if(a=[],D.test(e.charAt(G))?(s=e.charAt(G),G++):(s=m,0===$&&n(L)),s!==m)for(;s!==m;)a.push(s),D.test(e.charAt(G))?(s=e.charAt(G),G++):(s=m,0===$&&n(L));else a=y;a!==m?(34===e.charCodeAt(G)?(s=U,G++):(s=m,0===$&&n(B)),s!==m?(O=t,r=V(a),t=r):(G=t,t=y)):(G=t,t=y)}else G=t,t=y;if(t===m){if(t=G,r=[],X.test(e.charAt(G))?(a=e.charAt(G),G++):(a=m,0===$&&n(M)),a!==m)for(;a!==m;)r.push(a),X.test(e.charAt(G))?(a=e.charAt(G),G++):(a=m,0===$&&n(M));else r=y;r!==m&&(O=t,r=V(r)),t=r}return t}function p(){var t,r,a,s;if(t=G,33===e.charCodeAt(G)?(r=P,G++):(r=m,0===$&&n(Z)),r!==m){for(a=[],b.test(e.charAt(G))?(s=e.charAt(G),G++):(s=m,0===$&&n(C));s!==m;)a.push(s),b.test(e.charAt(G))?(s=e.charAt(G),G++):(s=m,0===$&&n(C));a!==m?(O=t,r=z(),t=r):(G=t,t=y)}else G=t,t=y;return t}function d(e){return e.join("")}var f,h=arguments.length>1?arguments[1]:{},m={},g={start:s},v=s,y=m,b=/^[ ]/,C={type:"class",value:"[ ]",description:"[ ]"},E=null,x=function(e,t){var r=[e];return null===t?r:r.concat(t)},j=":",q={type:"literal",value:":",description:'":"'},A=function(e,t,r){return{field:t,value:r,op:e}},N=function(e,t){return{field:e,value:t}},S="board",w={type:"literal",value:"board",description:'"board"'},k="groupby",R={type:"literal",value:"groupby",description:'"groupby"'},_="sort",F={type:"literal",value:"sort",description:'"sort"'},Q="sortdir",T={type:"literal",value:"sortdir",description:'"sortdir"'},J="title",I={type:"literal",value:"title",description:'"title"'},U='"',B={type:"literal",value:'"',description:'"\\""'},D=/^[^"]/,L={type:"class",value:'[^"]',description:'[^"]'},V=function(e){return d(e)},X=/^[^ ]/,M={type:"class",value:"[^ ]",description:"[^ ]"},P="!",Z={type:"literal",value:"!",description:'"!"'},z=function(){return{type:"unary",name:"not"}},G=0,O=0,H=0,K={line:1,column:1,seenCR:!1},W=0,Y=[],$=0;if("startRule"in h){if(!(h.startRule in g))throw new Error("Can't start parsing from rule \""+h.startRule+'".');v=g[h.startRule]}if(f=v(),f!==m&&G===e.length)return f;throw f!==m&&G<e.length&&n({type:"end",description:"end of input"}),a(null,Y,W)}return e(t,Error),{SyntaxError:t,parse:r}}();define("peg/grammar",[],function(){return _parser}),define("query",["./peg/grammar"],function(e){return{defaultQuery:"board:nC8QJJoZ groupby:idList",parse:function(t){for(var r={filters:[]},n=e.parse(t),a=0;a<n.length;++a){var s=n[a],i=s.field,o=s.value;switch(i){case"board":case"groupby":case"sort":case"sortdir":r[i]=o;break;case"title":r.filters.push(s)}}return r.terms=n,r.str=t,r}}}),define("stores/lists",[],function(){var e={};return e.lists={},e.set=function(t,r){e.lists[t]=r},e.get=function(t){return e.lists[t]},e}),define("views/trello_item",["react","stores/lists"],function(e,t){return e.createClass({getInitialState:function(){return{checked:!1}},handleClick:function(e){"A"!==e.target.tagName&&this.setState({checked:!this.state.checked})},render:function(){return e.createElement("tr",{className:"trelloItem",onClick:this.handleClick},e.createElement("td",{className:"checkCol"},e.createElement("input",{type:"checkbox",checked:this.state.checked,onChange:this.handleClick})),e.createElement("td",{className:"titleCol"},e.createElement("a",{href:this.props.data.url},this.props.data.name)),e.createElement("td",{className:"listCol"},t.get(this.props.data.idList).name),e.createElement("td",{className:"stateCol"},this.props.data.closed?"closed":"open"),e.createElement("td",{className:"dueCol"},this.props.data.due))}})}),define("views/trello_group",["react","./trello_item"],function(e,t){return e.createClass({render:function(){var r,n=this.props.cards.map(function(r){return e.createElement(t,{key:r.id,data:r})});return null!==this.props.group&&(r=e.createElement("div",{className:"panel-heading"},e.createElement("h1",{className:"panel-title"},this.props.group))),e.createElement("div",{className:"trelloGroup panel panel-info"},r,e.createElement("table",{className:"trello table table-striped"},e.createElement("thead",null,e.createElement("tr",null,e.createElement("th",{className:"checkCol"},"Â "),e.createElement("th",{className:"titleCol"},"Title"),e.createElement("th",{className:"listCol"},"List"),e.createElement("th",{className:"stateCol"},"State"),e.createElement("th",{className:"dueCol"},"Due"))),e.createElement("tbody",null,n)))}})}),define("views/query_bar",["react","query"],function(e,t){return e.createClass({getDefaultProps:function(){return{queue:[]}},getInitialState:function(){return t.parse(t.defaultQuery)},handleSubmit:function(e){e.preventDefault(),this.updateVal(e.target.getElementsByTagName("input")[0].value)},handleChange:function(e){this.state.timer&&clearTimeout(this.state.timer);var t=e.target;this.state.timer=setTimeout(function(){this.updateVal(t.value)}.bind(this),500)},updateVal:function(e){var r;r=""===e?{str:""}:t.parse(e),this.setState(r),this.props.onUpdate(r)},render:function(){return e.createElement("h3",{className:"page-header"},e.createElement("form",{onSubmit:this.handleSubmit},e.createElement("input",{id:"queryInput",type:"text",className:"form-control",defaultValue:this.state.str,onChange:this.handleChange})))}})}),define("views/trello_board",["react","trello","query","stores/lists","./trello_group","./query_bar"],function(e,t,r,n,a,s){return e.createClass({getInitialState:function(){return{response:{cards:[]},filtered:[],query:r.parse(r.defaultQuery)}},updateBoard:function(e){console.log("Updating board with query",e),t.boards.get(e.board,{cards:"all",lists:"all"},function(t){for(var r=0;r<t.lists.length;r++){var a=t.lists[r];n.set(a.id,a)}this.setState({response:t,filtered:[],query:e})}.bind(this))},componentDidMount:function(){this.updateBoard(this.state.query)},updateQuery:function(e){this.state.query.board!==e.board?this.updateBoard(e):(this.state.query=e,this.setState(this.state))},render:function(){for(var t={},r=this.state.response.cards,n=this.state.query.filters,i=this.state.query.groupby,o=0;o<r.length;++o){for(var l=r[o],u=!0,c=0;c<n.length;++c){var p=n[c];u=p.op&&"not"==p.op.name?u&&!l.name.match(p.value):u&&l.name.match(p.value)}if(u){var d=l[i]||"ungrouped";void 0===t[d]?t[d]=[l]:t[d].push(l)}}var f=this.state.query.sort,h=null;void 0!==f&&(h=function(e,t){return e[f]>t[f]});var m=[];for(var g in t){var r=t[g];null!==h&&r.sort(h);var v;v=void 0===i?null:this.groupName(g),m.push(e.createElement(a,{key:g,group:v,cards:r}))}return e.createElement("div",{className:"container"},e.createElement(s,{onUpdate:this.updateQuery})," ",m)},groupName:function(e){if("idList"===this.state.query.groupby){var t=n.get(e);return void 0!==t?t.name:"N/A"}return e}})}),define("app",["react","./views/trello_board"],function(e,t){var r={};return r.init=function(){e.render(e.createElement(t,null),document.body)},r}),define("util",{setQueryString:function(e){var t=[];for(var r in e)t.push(r+"="+e[r]);window.location.search="?"+t.join("&")},getQueryString:function(){var e=window.location.search.substr(1).split("&");if(""==e)return{};for(var t={},r=0;r<e.length;++r){var n=e[r].split("=",2);t[n[0]]=1==n.length?"":decodeURIComponent(n[1].replace(/\+/g," "))}return t}}),require.config({baseUrl:"js",paths:{bootstrap:"//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/js/bootstrap.min",jquery:"//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min",jsx:"bower_components/requirejs-react-jsx/jsx",JSXTransformer:"//cdnjs.cloudflare.com/ajax/libs/react/0.13.3/JSXTransformer",react:"//cdnjs.cloudflare.com/ajax/libs/react/0.13.3/react",text:"bower_components/requirejs-text/text",trello:"//api.trello.com/1/client.js?key=cd8f1241e56eb1c3d1fc2eb3b1d0708f"},shim:{bootstrap:["jquery"],JSXTransformer:"JSXTransformer",react:{exports:"React"},trello:{deps:["jquery"],exports:"Trello"}},config:{jsx:{fileExtension:".jsx",transformOptions:{harmony:!0,stripTypes:!1,inlineSourceMap:!0},usePragma:!1}}}),require(["app","jquery","trello","bootstrap","util"],function(e,t,r,n,a){r.authorize({name:"Trellofire",scope:{read:!0,write:!0,account:!1},expiration:"never",success:function(){var t=a.getQueryString();void 0===t.board?a.setQueryString({board:"nC8QJJoZ"}):e.init(t.board)},error:function(){alert("error")}})}),define("main",function(){});
//# sourceMappingURL=main.js.map